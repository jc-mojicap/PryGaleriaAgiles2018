
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Detalles</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>

    <script>
        $( function() {
            // run the currently selected effect
            function runEffect() {
                // get effect type from
                var selectedEffect = $( "Blind" ).val();

                // //Run the effect
                if($( "#effect" ).is(":visible")){
                    $( "#effect" ).hide( selectedEffect);
                    $( "#button" ).text("Mostrar Clips");
                }
                else{
                    $( "#effect" ).show( selectedEffect);
                    $( "#button" ).text("Ocultar Clips");
                }
            };
            // Set effect from select menu value
            $( "#button" ).on( "click", function() {
                runEffect();
            });
        });
    </script>
    <script>
        function obtenerValorParametro(sParametroNombre) {
            var sPaginaURL = window.location.search.substring(1);
            var sURLVariables = sPaginaURL.split('&');
            for (var i = 0; i < sURLVariables.length; i++) {
                var sParametro = sURLVariables[i].split('=');
                if (sParametro[0] == sParametroNombre) {
                    return sParametro[1];
                }
            }
            return null;
        }
    </script>
    <script>
        (function(){
            // $.getJSON("http://agilesgaleriagrupo4.herokuapp.com/polls/media").done(function (data) {
            $.getJSON('/polls/detalle/'+obtenerValorParametro("id")).done(function (data) {
                $.each(data, function (i, item) {
                    if(item.fields.tipo.toUpperCase() == "AUDIO"){
                        $("#media").prepend('<div class="embed-responsive embed-responsive-16by9 hoverable">' +
                            '<iframe class="embed-responsive-item" scrolling="no"   frameborder="no" ' +
                            'src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/'+ item.fields.url +
                            '&color=%23ff5500&visual=true&auto_play=false&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=false&visual=true&controls=0" ></iframe>');
                    }
                    else if(item.fields.tipo.toUpperCase() == "VIDEO"){
                        $("#media").prepend('<div class="embed-responsive embed-responsive-16by9 hoverable">' +
                            '<iframe class="embed-responsive-item" src="https://www.youtube.com/embed/' +
                            item.fields.url + '?controls=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>');
                    }
                    else {

                    }
                    $("#descr").prepend('<p>' + '<b>Usuario:</b>  ' + item.fields['usuario'] +'</p>');
                    $("#descr").prepend('<p>' + '<b>Ciudad:</b>  ' + item.fields['ciudad'] +'</p>');
                    $("#descr").prepend('<p>' + '<b>Pais:</b>  ' + item.fields['pais'] +'</p>');
                    $("#descr").prepend('<p>' + '<b>Fecha Creaci√≥n:</b>  ' + item.fields['fecha_creacion'] +'</p>');
                    $("#descr").prepend('<p>' + '<b>Autor:</b>  ' + item.fields['autor'] +'</p>');
                    $("#descr").prepend('<p>' + '<b>Titulo:</b> ' + item.fields['titulo'] +'</p>');
                    // $.each(item.fields, function (i, item) {
                    //     $("#descr").prepend('<p>' + item['url'] +'</p>');
                    // });
                    // $("#descr").prepend('<div><p>' + item.fields + ':'  + item.fields.url + '</p></div>');
                });
            });
        })();

        (function(){
            $.getJSON('/polls/detalle/'+obtenerValorParametro("id")+"/clips").done(function (data) {
                $.each(data, function (i, clip) {
                    $("#clips").prepend('<p>' + clip.nombre + '<button type="button" class="btn btn-default" id="' +  clip.nombre + '"><span class="glyphicon glyphicon-play"></span></button></p>')
                    $("#" + clip.nombre).click(function() {
                        loadMedia(clip)
                    });
                });
            });
        })();

        function loadMedia(clip) {
            let tipo = clip.media.tipo;
            let url = clip.media.url;
            let start = getSeconds(clip.seg_ini);
            let end = getSeconds(clip.seg_fin);
            if(tipo.toUpperCase() === "AUDIO") {
                $("#media").html('<h1> algo</h1>')
            } else {
                $("#media").html('<div class="embed-responsive embed-responsive-16by9 hoverable">' +
                    '<iframe class="embed-responsive-item" src="https://www.youtube.com/embed/' + url + '?controls=1&start=' + start + '&end=' + end + '" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>');
            }
        }

        function getSeconds(time) {
            let parts = time.split(":");
            let hours = parseInt(parts[0]);
            let minutes = parseInt(parts[1]);
            let seconds = parseInt(parts[2]);
            return (hours * 3600) + (minutes*60) + seconds;
        }
    </script>
</head>
<body>
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-target="#navbar" aria-expanded="false">
                <span class="sr-only">Toggle Navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/polls/">Galeria</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav"></ul>
            <ul class="nav navbar-nav navbar-right">
                <!--<li id="add_image"><a href="http://localhost:9000/polls/agregarImagen">Agregar Imagen</a></li>-->
                <!--<li id="add_user"><a href="http://localhost:9000/polls/agregarUsuario">Registro</a></li>-->
                <!--<li id="cerrar_sesion"><a class="glyphicon glyphicon-log-out" href="#"-->
                <!--id="clic_cerrar_sesion" onclick="logout();">Logout</a></li>-->
                <!--<li id="login_user"><a class="glyphicon glyphicon-log-in"-->
                <!--href="http://localhost:9000/polls/ingresar">Login</a></li>-->
            </ul>
        </div>
    </div>
</nav>
<br>
<br>
<h1 align="center">Detalle Galeria</h1>
<div class="col-md-6" id="media"></div>
<div class="col-md-6" id="descr"></div>
<button id="button" class="ui-state-default ui-corner-all">Mostrar Clips</button>
<div class="row">
    <div id="effect" class="ui-widget-content ui-corner-all" hidden = "True">
        <h3>Clips</h3>
        <div id="clips"></div>
        <button type="button" class="btn btn-default">
            <span class="glyphicon glyphicon-plus"></span>
        </button>
    </div>
</div>
</body>
</html>