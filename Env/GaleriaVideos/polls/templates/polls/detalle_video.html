{% extends "polls/base.html" %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>{% block title %}Detalles{% endblock %}</title>
    {% block scripts %}
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/resources/demos/style.css">

    <style>
        .play_clip_btn {
            margin-left: 10px;
        }
        .clip_container {
            padding: 0px 20px 20px 20px;
        }
        .form_div {
            margin: 20px;
        }
    </style>
    <script>
        function obtenerValorParametro(sParametroNombre) {
            var sPaginaURL = window.location.search.substring(1);
            var sURLVariables = sPaginaURL.split('&');
            for (var i = 0; i < sURLVariables.length; i++) {
                var sParametro = sURLVariables[i].split('=');
                if (sParametro[0] == sParametroNombre) {
                    return sParametro[1];
                }
            }
            return null;
        }

        (function(){
            // $.getJSON("http://agilesgaleriagrupo4.herokuapp.com/polls/media").done(function (data) {
            $.getJSON('/polls/detalle/'+obtenerValorParametro("id")).done(function (data) {
                $.each(data, function (i, item) {
                    if(item.fields.tipo.toUpperCase() == "AUDIO"){
                        $("#media").prepend('<div class="embed-responsive embed-responsive-16by9 hoverable">' +
                            '<iframe class="embed-responsive-item" scrolling="no"   frameborder="no" ' +
                            'src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/'+ item.fields.url +
                            '&color=%23ff5500&visual=true&auto_play=false&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=false&visual=true&controls=0" ></iframe>');
                    }
                    else if(item.fields.tipo.toUpperCase() == "VIDEO"){
                        $("#media").prepend('<div class="embed-responsive embed-responsive-16by9 hoverable">' +
                            '<iframe class="embed-responsive-item" src="https://www.youtube.com/embed/' +
                            item.fields.url + '?controls=1" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>');
                    }
                    else {

                    }
                    $("#descr").prepend('<p>' + '<b>Usuario:</b>  ' + item.fields['user'] +'</p>');
                    $("#descr").prepend('<p>' + '<b>Ciudad:</b>  ' + item.fields['ciudad'] +'</p>');
                    $("#descr").prepend('<p>' + '<b>Pais:</b>  ' + item.fields['pais'] +'</p>');
                    $("#descr").prepend('<p>' + '<b>Fecha Creaci√≥n:</b>  ' + item.fields['fecha_creacion'] +'</p>');
                    $("#descr").prepend('<p>' + '<b>Autor:</b>  ' + item.fields['autor'] +'</p>');
                    $("#descr").prepend('<p>' + '<b>Titulo:</b> ' + item.fields['titulo'] +'</p>');
                    // $.each(item.fields, function (i, item) {
                    //     $("#descr").prepend('<p>' + item['url'] +'</p>');
                    // });
                    // $("#descr").prepend('<div><p>' + item.fields + ':'  + item.fields.url + '</p></div>');
                });
            });
        })();

        // --------------------------------------
        // Clip functions
        // --------------------------------------

        (function(){
            $.getJSON('/polls/detalle/'+obtenerValorParametro("id")+"/clips").done(function (data) {
                if (data.length > 0) {
                    $.each(data, function (i, clip) {
                        $("#clips").prepend('<p>' + clip.nombre + '<button type="button" class="btn btn-default play_clip_btn" id="' +  clip.nombre + '"><span class="glyphicon glyphicon-play"></span></button></p>')
                        $("#" + clip.nombre).click(function() {
                            loadMedia(clip)
                        });
                    });
                } else {
                    $("#clips").prepend('<p>Esta media todavia no tiene clips</p>')
                }
            });
        })();

        function loadMedia(clip) {
            let tipo = clip.media.tipo;
            let url = clip.media.url;
            let start = getSeconds(clip.seg_ini);
            let end = getSeconds(clip.seg_fin);
            if(tipo.toUpperCase() === "AUDIO") {
                $("#media").html('<div class="embed-responsive embed-responsive-16by9 hoverable">' +
                    '<iframe class="embed-responsive-item" scrolling="no"   frameborder="no" ' +
                    'src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/'+ url +
                    '&color=%23ff5500&visual=true&auto_play=false&hide_related=true&show_comments=false&show_user=false&show_reposts=false&show_teaser=false&visual=true&controls=0" ></iframe>');
            } else {
                $("#media").html('<div class="embed-responsive embed-responsive-16by9 hoverable">' +
                    '<iframe class="embed-responsive-item" src="https://www.youtube.com/embed/' + url + '?controls=1&start=' + start + '&end=' + end + '&autoplay=1" frameborder="0" allow="autoplay"; encrypted-media" allowfullscreen></iframe></div>');
            }
        }

        function getSeconds(time) {
            let parts = time.split(":");
            let hours = parseInt(parts[0]);
            let minutes = parseInt(parts[1]);
            let seconds = parseInt(parts[2]);
            return (hours * 3600) + (minutes*60) + seconds;
        }

        function addClip() {
            return false;
        }
    </script>
    {% endblock %}
</head>
<body>
{% block content %}
<h1 align="center">Detalle Galeria</h1>
<div class="col-md-6" id="media"></div>
<div class="col-md-6" id="descr"></div>
<div class="row">
    <div class="container-fluid">
        <div class="ui-widget-content ui-corner-all col-lg-12 clip_container">
            <h3>Clips Recomendados</h3>
            <div id="clips"></div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="ui-widget-content ui-corner-all col-lg-12 clip_container">
            <h3>Agregar Clip</h3>
            <form action="" method="post" onsubmit="return addClip()">
                <div class="form_div">
                    <label for="form_nombre">Nombre</label>
                    <input type="text" name="form_nombre" id="form_nombre">
                </div>
                <div class="form_div">
                    <label for="form_seg_ini">Seg Ini</label>
                    <input type="time" step="1" name="form_seg_ini" id="form_seg_ini">
                </div>
                <div class="form_div">
                    <label for="form_seg_fin">Seg Fin</label>
                    <input type="time" step="1" name="form_seg_fin" id="form_seg_fin">
                </div>
                <button type="submit" class="btn btn-default pull-right">
                    <span class="glyphicon glyphicon-plus"></span>
                </button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
</body>
</html>